<!DOCTYPE html>
<html>
<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <style>
    #mindmap-root {
      width: 100%;
      height: 600px;
      background: #f8fafc;
      border-radius: 8px;
      overflow: hidden;
    }
  </style>
</head>
<body>
  <div id="mindmap-root"></div>

  <script type="text/babel">
    // Configure your site structure here
    const siteStructure = {
      id: 'root',
      label: 'Home',
      path: 'https://www.parkjason.com', // Replace with your Webflow homepage URL
      children: [
        {
          id: 'products',
          label: 'Products',
          path: '/products', // Replace with your products page URL
          children: [
            { 
              id: 'software',
              label: 'Software',
              path: '/products/software' // Replace with your software page URL
            },
            {
              id: 'hardware',
              label: 'Hardware',
              path: '/products/hardware' // Replace with your hardware page URL
            }
          ]
        },
        {
          id: 'about',
          label: 'About',
          path: '/about', // Replace with your about page URL
          children: [
            { id: 'team', label: 'Team', path: '/about/team' },
            { id: 'contact', label: 'Contact', path: '/about/contact' }
          ]
        }
      ]
    };

    const MindMap = () => {
      const [dimensions, setDimensions] = React.useState({ width: 800, height: 600 });
      const [transform, setTransform] = React.useState({ x: 0, y: 0, scale: 1 });
      const [isDragging, setIsDragging] = React.useState(false);
      const [dragStart, setDragStart] = React.useState({ x: 0, y: 0 });
      const svgRef = React.useRef(null);

      // Get current path to highlight active node
      const currentPath = window.location.pathname;

      React.useEffect(() => {
        const updateDimensions = () => {
          const container = document.getElementById('mindmap-root');
          if (container) {
            setDimensions({
              width: container.clientWidth,
              height: container.clientHeight
            });
          }
        };

        updateDimensions();
        window.addEventListener('resize', updateDimensions);
        return () => window.removeEventListener('resize', updateDimensions);
      }, []);

      const calculateNodePositions = (node, level = 0, angle = 0) => {
        const positions = [];
        const radius = Math.min(dimensions.width, dimensions.height) / 3;
        
        const x = Math.cos(angle) * (radius * level);
        const y = Math.sin(angle) * (radius * level);

        positions.push({
          id: node.id,
          label: node.label,
          x,
          y,
          path: node.path,
          isActive: currentPath === node.path,
          level
        });

        if (node.children) {
          const startAngle = -Math.PI / 2;
          const angleStep = (2 * Math.PI) / node.children.length;
          
          node.children.forEach((child, index) => {
            const childAngle = startAngle + angleStep * index;
            positions.push(...calculateNodePositions(child, level + 1, childAngle));
          });
        }

        return positions;
      };

      const nodes = calculateNodePositions(siteStructure);

      const createConnections = () => {
        const connections = [];
        const addConnections = (node, parentId = null) => {
          if (parentId) {
            connections.push({ from: parentId, to: node.id });
          }
          if (node.children) {
            node.children.forEach(child => addConnections(child, node.id));
          }
        };
        addConnections(siteStructure);
        return connections;
      };

      const connections = createConnections();

      const handleZoomButton = (direction) => {
        const scaleFactor = 1.2;
        setTransform(prev => {
          const newScale = direction === 'in' ? prev.scale * scaleFactor : prev.scale / scaleFactor;
          return {
            ...prev,
            scale: Math.min(Math.max(newScale, 0.5), 3)
          };
        });
      };

      const handleMouseDown = (e) => {
        if (e.button === 0) {
          setIsDragging(true);
          setDragStart({ x: e.clientX - transform.x, y: e.clientY - transform.y });
        }
      };

      const handleMouseMove = (e) => {
        if (isDragging) {
          setTransform(prev => ({
            ...prev,
            x: e.clientX - dragStart.x,
            y: e.clientY - dragStart.y
          }));
        }
      };

      const handleMouseUp = () => {
        setIsDragging(false);
      };

      const handleNodeClick = (path, e) => {
        if (!isDragging) {
          window.parent.location.href = path;
        }
      };

      const resetView = () => {
        setTransform({ x: 0, y: 0, scale: 1 });
      };

      return (
        <div style={{ position: 'relative', width: '100%', height: '100%' }}>
          <div style={{
            position: 'absolute',
            top: '1rem',
            right: '1rem',
            zIndex: 10,
            display: 'flex',
            gap: '0.5rem'
          }}>
            <button 
              onClick={() => handleZoomButton('out')}
              style={{
                width: '2.5rem',
                height: '2.5rem',
                background: 'white',
                border: 'none',
                borderRadius: '0.5rem',
                boxShadow: '0 1px 3px rgba(0,0,0,0.1)',
                cursor: 'pointer'
              }}
            >
              -
            </button>
            <button 
              onClick={() => handleZoomButton('in')}
              style={{
                width: '2.5rem',
                height: '2.5rem',
                background: 'white',
                border: 'none',
                borderRadius: '0.5rem',
                boxShadow: '0 1px 3px rgba(0,0,0,0.1)',
                cursor: 'pointer'
              }}
            >
              +
            </button>
            <button 
              onClick={resetView}
              style={{
                padding: '0.5rem 1rem',
                background: 'white',
                border: 'none',
                borderRadius: '0.5rem',
                boxShadow: '0 1px 3px rgba(0,0,0,0.1)',
                cursor: 'pointer'
              }}
            >
              Reset View
            </button>
          </div>

          <div 
            style={{ 
              position: 'relative',
              width: '100%',
              height: '100%',
              overflow: 'hidden'
            }}
            onMouseDown={handleMouseDown}
            onMouseMove={handleMouseMove}
            onMouseUp={handleMouseUp}
            onMouseLeave={handleMouseUp}
          >
            <svg 
              ref={svgRef}
              viewBox={`${-dimensions.width/2} ${-dimensions.height/2} ${dimensions.width} ${dimensions.height}`}
              style={{ width: '100%', height: '100%', cursor: 'move' }}
            >
              <g transform={`translate(${transform.x},${transform.y}) scale(${transform.scale})`}>
                {connections.map((connection) => {
                  const fromNode = nodes.find(n => n.id === connection.from);
                  const toNode = nodes.find(n => n.id === connection.to);
                  return (
                    <line
                      key={`${connection.from}-${connection.to}`}
                      x1={fromNode.x}
                      y1={fromNode.y}
                      x2={toNode.x}
                      y2={toNode.y}
                      stroke="#e2e8f0"
                      strokeWidth="2"
                    />
                  );
                })}
                
                {nodes.map((node) => (
                  <g
                    key={node.id}
                    transform={`translate(${node.x},${node.y})`}
                    onClick={(e) => handleNodeClick(node.path, e)}
                    style={{ cursor: 'pointer' }}
                  >
                    <circle
                      r="32"
                      fill="#e2e8f0"
                      opacity="0.5"
                      transform="translate(2,2)"
                    />
                    <circle
                      r="32"
                      fill={node.isActive ? '#3b82f6' : 'white'}
                      stroke="#3b82f6"
                      strokeWidth="2"
                    />
                    <text
                      dy=".3em"
                      textAnchor="middle"
                      fill={node.isActive ? 'white' : '#374151'}
                      style={{ fontSize: '14px', fontWeight: 500 }}
                    >
                      {node.label}
                    </text>
                  </g>
                ))}
              </g>
            </svg>
          </div>
        </div>
      );
    };

    ReactDOM.render(<MindMap />, document.getElementById('mindmap-root'));
  </script>
</body>
</html>
