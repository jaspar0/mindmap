<!DOCTYPE html>
<html>
<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <style>
    #mindmap-root {
      width: 100%;
      height: 600px;
      background: #f8fafc;
      border-radius: 8px;
      overflow: hidden;
    }
    .node-circle {
      transition: all 0.3s ease;
    }
    .node-circle:hover {
      fill: #93c5fd;
    }
  </style>
</head>
<body>
  <div id="mindmap-root"></div>

  <script type="text/babel">
    // Base URL for your Webflow site
    const BASE_URL = 'https://www.parkjason.com';
    
    // Site structure matching your Webflow pages
    const siteStructure = {
      id: 'root',
      label: 'Home',
      path: `${BASE_URL}`,
      children: [
        {
          id: 'about',
          label: 'About',
          path: `${BASE_URL}/about`
        },
        {
          id: 'work',
          label: 'Work',
          path: `${BASE_URL}/work`
        },
        {
          id: 'contact',
          label: 'Contact',
          path: `${BASE_URL}/contact`
        }
      ]
    };

    const MindMap = () => {
      const [dimensions, setDimensions] = React.useState({ width: 800, height: 600 });
      const svgRef = React.useRef(null);

      React.useEffect(() => {
        const updateDimensions = () => {
          const container = document.getElementById('mindmap-root');
          if (container) {
            setDimensions({
              width: container.clientWidth,
              height: container.clientHeight
            });
          }
        };

        updateDimensions();
        window.addEventListener('resize', updateDimensions);
        return () => window.removeEventListener('resize', updateDimensions);
      }, []);

      // Calculate node positions in a circle around the center
      const nodes = [
        { id: 'root', label: 'Home', x: 0, y: 0, path: siteStructure.path },
        { id: 'about', label: 'About', x: -120, y: 100, path: `${BASE_URL}/about` },
        { id: 'work', label: 'Work', x: 0, y: 140, path: `${BASE_URL}/work` },
        { id: 'contact', label: 'Contact', x: 120, y: 100, path: `${BASE_URL}/contact` }
      ];

      const handleNodeClick = (path) => {
        console.log('Node clicked:', path); // Debug log
        
        // Force navigation to the top window
        try {
          // First try to get the topmost parent window
          let topWindow = window;
          while (topWindow.parent !== topWindow) {
            topWindow = topWindow.parent;
          }
          console.log('Navigating to:', path);
          topWindow.location.href = path;
        } catch (e) {
          console.log('Navigation error:', e);
          // If accessing parent window fails, try direct navigation
          window.location.href = path;
        }
      };

      return (
        <div style={{ width: '100%', height: '100%', position: 'relative' }}>
          <svg 
            ref={svgRef}
            viewBox={`${-dimensions.width/4} ${-dimensions.height/4} ${dimensions.width/2} ${dimensions.height/2}`}
            style={{ width: '100%', height: '100%' }}
          >
            {/* Draw connections */}
            {nodes.slice(1).map(node => (
              <line 
                key={`line-${node.id}`}
                x1="0" 
                y1="0" 
                x2={node.x} 
                y2={node.y} 
                stroke="#e2e8f0" 
                strokeWidth="2" 
              />
            ))}

            {/* Draw nodes */}
            {nodes.map((node) => (
              <g
                key={node.id}
                transform={`translate(${node.x},${node.y})`}
                onClick={() => handleNodeClick(node.path)}
                style={{ cursor: 'pointer' }}
              >
                <circle
                  r="40"
                  className="node-circle"
                  fill="white"
                  stroke="#3b82f6"
                  strokeWidth="2"
                />
                <text
                  dy=".3em"
                  textAnchor="middle"
                  fill="#374151"
                  style={{ 
                    fontSize: '14px', 
                    fontFamily: 'Arial, sans-serif',
                    pointerEvents: 'none'
                  }}
                >
                  {node.label}
                </text>
              </g>
            ))}
          </svg>
        </div>
      );
    };

    ReactDOM.render(<MindMap />, document.getElementById('mindmap-root'));
  </script>
</body>
</html>
